@model AdminStudentUpdateVM

@{
    ViewData["Title"] = @SharedLocalizer["Update"];
}
<style>
    .select2-search__field {
        height: 37px !important;
    }
</style>
<!--begin::Modal - Add task-->
@* <div class="modal fade" id="kt_modal_update_student" tabindex="-1" aria-hidden="true"> *@
<div class="modal fade show" id="kt_modal_update_student" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">

    <!--begin::Modal dialog-->
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <!--begin::Modal content-->
        <div class="modal-content">
            <!--begin::Modal header-->
            <div class="modal-header" id="kt_modal_update_user_header">
                <!--begin::Modal title-->
                <h2 class="fw-bolder">@SharedLocalizer["Update"]</h2>
                <!--end::Modal title-->
                <!--begin::Close-->

                <div class="btn btn-icon btn-sm btn-active-icon-primary" data-kt-users-modal-action="closes">
                    <!--begin::Svg Icon | path: icons/duotune/arrows/arr061.svg-->
                    <span class="svg-icon svg-icon-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="currentColor" />
                            <rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="currentColor" />
                        </svg>
                    </span>
                    <!--end::Svg Icon-->
                </div>
                <!--end::Close-->
            </div>
            <!--end::Modal header-->
            <!--begin::Modal body-->
            <div class="modal-body scroll-y mx-5 mx-xl-15 my-7">
                <!--begin::Form-->
                <form asp-area="Admin" asp-controller="Student" asp-action="Update" id="kt_modal_update_student_form" class="form" enctype="multipart/form-data">
                    <input type="hidden" asp-for="Id" />
                    <input type="hidden" asp-for="RemoveImage" id="RemoveImage" />
                    <!--begin::Scroll-->
                    <div class="row mb-7 scroll-y me-n7 pe-7" id="kt_modal_update_user_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#kt_modal_update_user_header" data-kt-scroll-wrappers="#kt_modal_update_user_scroll" data-kt-scroll-offset="300px">
                        <div class="row g-5">
                            <div class="d-flex flex-row justify-content-between mb-5">
                                <div class="me-3">
                                    <div class="fv-row">
                                        <!--begin::Label-->
                                        <label class="d-block fw-bold fs-6 mb-5">
                                            @ViewLocalizer["Edit_Picture"]
                                            <i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title="@SharedLocalizer["Allowed_File_Types"]"></i>
                                        </label>
                                        <!--end::Label-->
                                        <!--begin::Image input wrapper-->
                                        <div class="mt-1">
                                            <!--begin::Image input-->
                                            <div class="image-input image-input-outline" data-kt-image-input="true" style="background-image: url('/images/blank-profile-picture.png')">
                                                <!--begin::Preview existing avatar-->
                                                <div id="profilePhoto" class="image-input-wrapper w-125px h-125px"></div>
                                                <!--end::Preview existing avatar-->
                                                <!--begin::Edit-->
                                                <label class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body" data-kt-image-input-action="change" data-bs-toggle="tooltipAdd" title="@SharedLocalizer["Upload_Profile_Picture"]">
                                                    <i class="bi bi-pencil-fill fs-7"></i>
                                                    <!--begin::Inputs-->
                                                    <input type="file" asp-for="NewImage" accept=".png, .jpg, .jpeg" />
                                                    <input asp-for="Image" type="hidden" />
                                                    <!--end::Inputs-->
                                                </label>
                                                <!--end::Edit-->
                                                <!--begin::Cancel-->
                                                <span class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body" data-kt-image-input-action="cancel" data-bs-toggle="tooltipCancel" title="@SharedLocalizer["Cancel_Profile_Picture"]">
                                                    <i class="bi bi-x fs-2"></i>
                                                </span>
                                                <!--end::Cancel-->
                                                <!--begin::Remove-->
                                                <span id="removeImageBtn" class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body" data-kt-image-input-action="remove" data-bs-toggle="tooltipRemove" title="@SharedLocalizer["Remove_Profile_Picture"]">
                                                    <i class="bi bi-x fs-2"></i>
                                                </span>
                                                <!--end::Remove-->
                                            </div>
                                            <!--end::Image input-->
                                        </div>
                                        <!--end::Image input wrapper-->
                                    </div>
                                </div>
                                <div>
                                    <div class="fv-row ms-12">
                                        <!--begin::Label-->
                                        <label asp-for="Gender" class="required fw-bold fs-6 mb-5">@SharedLocalizer["Gender"]</label>
                                        <!--end::Label-->
                                        <!--begin::Radio-->
                                        <div class="form-check form-check-custom form-check-solid mb-3">
                                            <!--begin::Input-->
                                            <input asp-for="Gender" class="form-check-input me-3" type="radio" value="true" id="kt_modal_update_role_option_0" checked='checked' />
                                            <!--end::Input-->
                                            <!--begin::Label-->
                                            <label class="form-check-label" for="kt_modal_update_role_option_0">
                                                <div class="fw-bolder text-gray-800">@SharedLocalizer["Man"]</div>
                                            </label>
                                            <!--end::Label-->
                                        </div>
                                        <!--end::Radio-->
                                        <!--begin::Radio-->
                                        <div class="form-check form-check-custom form-check-solid mb-3">
                                            <!--begin::Input-->
                                            <input asp-for="Gender" class="form-check-input me-3" type="radio" value="false" id="kt_modal_update_role_option_1" />
                                            <!--end::Input-->
                                            <!--begin::Label-->
                                            <label class="form-check-label" for="kt_modal_update_role_option_1">
                                                <div class="fw-bolder text-gray-800">@SharedLocalizer["Woman"]</div>
                                            </label>
                                            <!--end::Label-->
                                        </div>
                                        <!--end::Radio-->
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="fv-row form-floating mb-7">
                                        <!--begin::Input-->
                                        <input asp-for="FirstName" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="@SharedLocalizer["First_Name"]" />
                                        <!--end::Input-->
                                        <!--begin::Label-->
                                        <label asp-for="FirstName" class="required fw-bold fs-6 mb-2"></label>
                                        <!--end::Label-->
                                        <span asp-validation-for="FirstName" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="fv-row form-floating mb-7">
                                        <!--begin::Input-->
                                        <input asp-for="LastName" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="@SharedLocalizer["Last_Name"]" />
                                        <!--end::Input-->
                                        <!--begin::Label-->
                                        <label asp-for="LastName" class="required fw-bold fs-6 mb-2"></label>
                                        <!--end::Label-->
                                        <span asp-validation-for="LastName" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="fv-row form-floating mb-7">
                                        <!--begin::Input-->
                                        <input asp-for="Email" type="email" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="ad.soyad@bilgeadam.com" />
                                        <!--end::Input-->
                                        <!--begin::Label-->
                                        <label asp-for="Email" class="required fw-bold fs-6 mb-2"></label>
                                        <!--end::Label-->
                                        <span asp-validation-for="Email" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="fv-row form-floating mb-7 ">
                                        <div>

                                            <select id="classSelectUpdate" class="form-select form-select-sm form-select-solid mb-3 mb-lg-0 select2-dropdown" asp-for="ClassroomIds" asp-items="@ViewBag.Classrooms" data-control="select2" data-close-on-select="false" data-allow-clear="true" data-placeholder="@SharedLocalizer["Choose_Classroom"]" multiple="multiple">
                                                <option value=""></option>
                                            </select>
                                            <span asp-validation-for="ClassroomIds" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Uncomment and adjust the code for OtherEmails section -->
                            @*
                            @if (Model.OtherEmails != null)
                            {
                            @foreach (var items in Model.OtherEmails)
                            {
                            <div class="fv-row mb-7">
                            <div class="d-flex align-items-center">
                            <label asp-for="OtherEmails" class="form-label mt-3" style="font-size: 20px; font-weight: bold;"></label>
                            <span class="required"></span>
                            <i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title="" data-bs-original-title="Eğitmenin diğer mail adresini giriniz." aria-label="Eğitmenin diğer mail adresini giriniz."></i>
                            </div>
                            <div class="d-flex">
                            <input type="text" class="form-control form-control-solid" value="@items" name="anotherEmails">
                            <span asp-validation-for="OtherEmails" class="text-danger"></span>
                            <div class="align-self-end d-flex flex-row-reverse justify-content-end ms-2">
                            <a class="btn btn-danger btn-sm" onclick="removeMail(this)"><span class="h5 text-light">X</span></a>
                            </div>
                            </div>
                            </div>
                            }
                            }

                            <div id="anotherEmails"></div>

                            <div>
                            <a class="cursor-pointer btn btn-success form-control mb-7" onclick="addAnotherEmail()">@ViewLocalizer["Add_Other_Email"]</a>
                            <div class="fv-plugins-message-container invalid-feedback"></div>
                            </div> *@

                        </div>
                    </div>
                    <!--end::Scroll-->
                    <!--begin::Actions-->
                    <div class="text-center pt-15">
                        <button type="button" class="btn btn-light me-3" id="backListButton" data-bs-toggle="modal" data-bs-target="#unsavedChangesModal">
                            @SharedLocalizer["Back_List"]
                        </button>

                        <button type="submit" class="btn btn-success" data-kt-users-modal-action="submits">
                            <span class="indicator-label">@SharedLocalizer["Save"]</span>
                            <span class="indicator-progress">
                                @SharedLocalizer["Please_Wait"]
                                <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                            </span>
                        </button>
                    </div>
                    <!--end::Actions-->
                </form>
                <!--end::Form-->
            </div>
            <!--end::Modal body-->
        </div>
        <!--end::Modal content-->
    </div>
    <!--end::Modal dialog-->
</div>

<!--end::Modal - Add task-->
<div class="modal fade" id="unsavedChangesModal" tabindex="-1" aria-labelledby="unsavedChangesModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="unsavedChangesModalLabel">Değişiklikleriniz Kaydedilmedi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Değişikliklerinizi kaydetmediniz. Yine de listeye dönmek istiyor musunuz?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                <button type="button" class="btn btn-primary" id="confirmExitButton">Evet, Devam Et</button>
            </div>
        </div>
    </div>
</div>

<script>
    var validationMessage = "@SharedLocalizer["Picture_Format_Error"]";
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        "use strict";

        function getCultureLanguage() {
            let match = document.cookie.match(/\.AspNetCore\.Culture=([^;]+)/);
            if (!match) return null;

            let cultureValue = decodeURIComponent(match[1]);
            let langMatch = cultureValue.match(/c=([a-zA-Z-]+)/);

            return langMatch ? langMatch[1] : null;
        }

        function getCurrentLanguage() {
            let language = getCultureLanguage();
            if (language && language.startsWith('tr')) {
                return 'tr';
            } else if (language && language.startsWith('en')) {
                return 'en';
            } else {
                return 'tr';
            }
        }

        var language = getCurrentLanguage();
        var localizedTexts = {
            tr: {
                unsavedChangesTitle: "Değişiklikleri Kaydetmediniz!",
                unsavedChangesText: "Bu sayfadan çıkmak istediğinize emin misiniz?",
                confirmButtonText: "Evet",
                cancelButtonText: "Hayır, Kalmak İstiyorum"
            },
            en: {
                unsavedChangesTitle: "Unsaved changes!",
                unsavedChangesText: "Your changes will be lost. Do you want to proceed?",
                confirmButtonText: "Yes",
                cancelButtonText: "No, I want to stay"
            }
        }[language];

        let form = document.querySelector("#kt_modal_update_student_form");
        let isFormChanged = false;

        if (form) {
            form.addEventListener("input", function () {
                isFormChanged = true;
            });
        }

        let backButton = document.querySelector("#backListButton");

        if (backButton) {
            backButton.addEventListener("click", function (event) {
                event.preventDefault();

                Swal.fire({
                    title: localizedTexts.unsavedChangesTitle,
                    text: localizedTexts.unsavedChangesText,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: localizedTexts.confirmButtonText,
                    cancelButtonText: localizedTexts.cancelButtonText,
                    customClass: {
                        confirmButton: "btn btn-danger",
                        cancelButton: "btn btn-primary"
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = '/Admin/Student/Index';
                    }
                });
            });
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const inputs = document.querySelectorAll('#kt_modal_update_student_form input[type="text"], #kt_modal_update_student_form input[type="email"]');
        const genderInputs = document.querySelectorAll('input[name="Gender"]');
        const imageInput = document.querySelector('input[name="NewImage"]');
        const form = document.querySelector('#kt_modal_update_student_form');

        // Yıldız ekleme fonksiyonu
        function addRequiredStar(element) {
            const parentDiv = element.closest('.fv-row');
            if (parentDiv) {
                const label = parentDiv.querySelector('label');
                if (label) {
                    // Önce varolan yıldızları temizleyelim
                    const existingStars = label.querySelectorAll('.required-star, .required');
                    existingStars.forEach(star => star.remove());

                    // Yeni yıldız ekleyelim
                    const star = document.createElement('span');
                    star.className = 'required-star text-danger ms-1';
                    star.textContent = '*';
                    label.appendChild(star);
                }
            }
        }

        // Yıldız kaldırma fonksiyonu
        function removeRequiredStar(element) {
            const parentDiv = element.closest('.fv-row');
            if (parentDiv) {
                const label = parentDiv.querySelector('label');
                if (label) {
                    // Tüm yıldızları ve required class'ını temizleyelim
                    label.classList.remove('required');
                    const stars = label.querySelectorAll('.required-star, .required');
                    stars.forEach(star => star.remove());
                }
            }
        }

        // Boş alan kontrolü
        function checkEmptyFields() {
            let hasEmptyFields = false;
            inputs.forEach(input => {
                if (!input.value || input.value.trim() === '') {
                    addRequiredStar(input);
                    hasEmptyFields = true;
                }
            });
            return hasEmptyFields;
        }

        // Sayfa ilk yüklendiğinde tüm yıldızları kaldır
        inputs.forEach(input => {
            removeRequiredStar(input);

            // Input değişikliklerini dinle
            input.addEventListener('input', function () {
                if (!this.value || this.value.trim() === '') {
                    addRequiredStar(this);
                } else {
                    removeRequiredStar(this);
                }
            });
        });

        // Cinsiyet ve resim alanları için yıldızları kaldır
        genderInputs.forEach(input => {
            removeRequiredStar(input);
        });
        if (imageInput) {
            removeRequiredStar(imageInput);
        }

        // Form submit kontrolü
        form.addEventListener('submit', function (event) {
            if (checkEmptyFields()) {
                event.preventDefault();
                Swal.fire({
                    title: language === 'tr' ? 'Uyarı!' : 'Warning!',
                    text: language === 'tr' ? 'Lütfen zorunlu alanları doldurunuz.' : 'Please fill in all required fields.',
                    icon: 'warning',
                    confirmButtonText: language === 'tr' ? 'Tamam' : 'OK'
                });
            }
        });
    });
</script>