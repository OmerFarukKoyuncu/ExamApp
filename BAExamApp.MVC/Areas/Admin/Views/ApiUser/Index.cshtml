
@model X.PagedList.IPagedList<AdminApiUserListVM>
@using BAExamApp.MVC.Areas.Admin.Models.ApiUserVMs
@using Microsoft.Extensions.Localization
@using X.PagedList
@using X.PagedList.Mvc.Common
@using X.PagedList.Mvc.Core
@using X.PagedList.Mvc.Core.Common
@inject IStringLocalizer<SharedModelResource> localizer

@{
	ViewData["Title"] = "Index";
	var currentPageSize = ViewBag.PageSize ?? 10;
}


<div class="card card-docs flex-row-fluid mb-2">
	<div class="card-body fs-6 py-15 px-10 py-lg-15 px-lg-15 text-gray-700">
		<!--begin::Card header-->
		<div class="p-0">
			<h5 class="anchor fw-bolder mb-5" id="server-side">@SharedLocalizer["List", SharedLocalizer["ApiUser"]]</h5>
			<div class="py-5">
				<!--begin::Card title-->
				<div class="d-flex flex-stack flex-wrap mb-5">
					<!--begin::Search-->
					<div class="d-flex align-items-center position-relative my-1">
						<form asp-controller="ApiUser" asp-action="Index" method="get" class="d-flex align-items-center">
							<div class="form-group">
								<!-- firstName adında bir giriş alanı, değeri ViewBag.FirstName'den alınıyor -->
								<input type="text" name="firstName" id="firstNameInput" value="@ViewBag.FirstName" class="form-control" placeholder=@SharedLocalizer["First_Name"] />
							</div>
							<!-- Soyad alanını içeren form grubu -->
							<div class="form-group me-2">
								<!-- lastName adında bir giriş alanı, değeri ViewBag.LastName'den alınıyor -->
								<input type="text" name="lastName" id="lastNameInput" value="@ViewBag.LastName" class="form-control" placeholder=@SharedLocalizer["Last_Name"] />
							</div>
							<!-- E-mail alanını içeren form grubu -->
							<div class="form-group me-2">
								<!-- email adında bir giriş alanı, değeri ViewBag.Email'den alınıyor -->
								<input type="text" name="email" id="emailInput" value="@ViewBag.Email" class="form-control" placeholder=@SharedLocalizer["Email"] />
							</div>
						
							<button type="submit" id="searchButton" class="btn btn-primary btn-lg hover-elevate-up ms-3" data-kt-user-table-filter="form">
								@SharedLocalizer["Show"]
							</button>
						</form>
					</div>
					<div class="d-flex justify-content-end" data-kt-docs-table-toolbar="base">
						<button type="button" class="btn btn-primary" data-bs-toggle="modal"
						        data-bs-target="#kt_modal_add_user">
							<!--begin::Svg Icon | path: icons/duotune/arrows/arr075.svg-->
							<span class="svg-icon svg-icon-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none">
                                <rect opacity="0.5" x="11.364" y="20.364" width="16" height="2" rx="1"
                                      transform="rotate(-90 11.364 20.364)" fill="currentColor"/>
                                <rect x="4.36396" y="11.364" width="16" height="2" rx="1" fill="currentColor"/>
                            </svg>
								</span>
							@SharedLocalizer["Create", SharedLocalizer["ApiUser"]]
						</button>
					</div>
				</div>

				<table class="table align-middle table-row-dashed fs-6 gy-5" id="kt_datatable_example_1">
					<!--begin::Table head-->
					<thead>
					<!--begin::Table row-->
					<tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
						<th>@SharedLocalizer["Profile_Image"]</th>
						<th>@SharedLocalizer["First_Name"]</th>
						<th>@SharedLocalizer["Last_Name"]</th>
						<th>@SharedLocalizer["Email"]</th>
						<th class="text-end">@SharedLocalizer["ApiUser_Operations"]</th>
					</tr>
					<!--end::Table row-->
					</thead>
					<!--end::Table head-->
					<!--begin::Table body-->
					<tbody class="text-gray-600 fw-bold">
					@if (Model.Count == 0)
					{
						<tr>
							<td colspan="8" class="text-center text-muted">
								@localizer["No_Results_Found"]
							</td>
						</tr>
					}
					else
					{
						@foreach (var apiUser in Model)
						{
							<tr style="height: 50px;">
								@if (apiUser.NewImage != null && apiUser.NewImage.Length > 0)
								{
									string imageBase64 = Convert.ToBase64String(apiUser.NewImage);
									string imageSrc = $"data:image/png;base64,{imageBase64}";
									<td class="d-flex align-items-center">
										<div class="symbol symbol-circle symbol-50px overflow-hidden me-3">
											<div class="symbol-label">
												<img src="@imageSrc" name="Image" alt="ApiUser Image"
												     class="w-100"/>
											</div>
										</div>
									</td>
								}
								else
								{
									<td class="d-flex align-items-center" style="padding: 5px 0;">
										<div class="symbol symbol-circle symbol-40px overflow-hidden me-3">
											<div class="symbol-label">
												<img src="~/images/blank-profile-picture.png"
												     alt="Profil Fotoğrafı Bulunamadı!" class="w-100"/>
											</div>
										</div>
									</td>
								}
								<td>
									<span>@apiUser.FirstName</span>
								</td>
								<td>
									<span>@apiUser.LastName</span>
								</td>
								<td>
									<span>@apiUser.Email</span>
								</td>
								<td class="text-end">
									<div class="dropdown">
										<button
											class="btn btn-light btn-active-light-primary btn-sm dropdown-toggle"
											type="button" id="dropdownMenuButton" data-bs-toggle="dropdown"
											aria-extended="false">
											@SharedLocalizer["Options"]
										</button>
										<ul class="dropdown-menu dropdown-menu-end menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bold fs-7 w-100 py-4"
										    aria-labelledby="dropdownMenuButton">
											<li class="menu-item px-3">
												<a asp-action="Details" asp-route-id="@apiUser.Id"
												   class="menu-link px-3">@SharedLocalizer["Details"]</a>
											</li>
											<li class="menu-item px-3">
												<a onclick="loadAdminData('@apiUser.Id')"
												   id="update-admin-button"
												   class="menu-link px-3"
												   data-bs-toggle="modal" data-bs-target="#kt_modal_update_user"
												   data-kt-users-table-filter="delete_row"
												   style="cursor: pointer;">
													@SharedLocalizer["Update"]
												</a>
											</li>
										</ul>
									</div>
								</td>
							</tr>
						}
					}
					<!--begin::Table row-->
					</tbody>
					<!--end::Table body-->
				</table>
				<!-- Pagination and Page Size Section -->
				<div class="d-flex flex-column flex-md-row justify-content-between align-items-center mt-4">
					<div class="d-flex align-items-center mb-3 mb-md-0 flex-wrap">
						<div class="dataTables_length me-3" id="kt_table_users_length">
							<label>
								<select id="pageSizeDropdown" name="kt_table_users_length"
								        aria-controls="kt_table_users"
								        class="form-select form-select-sm form-select-solid w-auto">
									<option value="10">10</option>
									<option value="25">25</option>
									<option value="50">50</option>
									<option value="100">100</option>
								</select>
							</label>
						</div>
						<div class="col-5" style="margin-left:10px">
					<span class="text" style="white-space: nowrap;">
						@SharedLocalizer["Total"] @Model.TotalItemCount @SharedLocalizer["From"] @(Model.PageNumber * Model.PageSize - (Model.PageSize - 1))
						@SharedLocalizer["To"] @(Model.PageNumber * Model.PageSize > Model.TotalItemCount ? Model.TotalItemCount : Model.PageNumber * Model.PageSize)
						@SharedLocalizer["Records_Are_Being_Displayed"]
					</span>
						</div>
					</div>

					<div class="d-flex justify-content-end mt-3">
						@Html.PagedListPager(Model, page => Url.Action("Index", new {
							page,
							firstName = ViewBag.FirstName,
							lastName = ViewBag.LastName,
							email = ViewBag.Email,
							pageSize = ViewBag.PageSize
						}), new PagedListRenderOptions
						{
							Display = PagedListDisplayMode.Always,
							UlElementClasses = new[] { "pagination", "justify-content-center" },
							LiElementClasses = new[] { "page-item" },
							PageClasses = new[] { "page-link" },
							LinkToFirstPageFormat = @localizer["First"],
							LinkToLastPageFormat = @localizer["Last"],
							ContainerDivClasses = new[] { "d-flex", "justify-content-center" }
						})
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!--end::Card-->

<partial name="~/Areas/Admin/Views/ApiUser/Update.cshtml" model="new AdminApiUserUpdateVM()"></partial>
<partial name="~/Areas/Admin/Views/ApiUser/Create.cshtml" model="new AdminApiUserCreateVM()"></partial>

@section Scripts
{
	<script src="~/lib/jquery/dist/jquery.min.js"></script>
	<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
	<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>

	@* <script src="~/newlayouts/dist/assets/plugins/custom/datatables/datatables.bundle.js"></script> *@
	<script src="~/newlayouts/src/js/custom/apps/user-management/users/list/add-apiUser.js"></script>
	<script src="~/newlayouts/src/js/custom/apps/user-management/users/list/update-apiUser.js"></script>
	<script src="~/js/searchboxkeyboardevent.js"></script>
	<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

	<style>
		/* Autocomplete kutusu */
		.ui-autocomplete {
			background-color: #fff;
			border: 1px solid #dee2e6;
			border-radius: 0.475rem;
			max-height: 250px;
			overflow-y: auto;
			font-size: 14px;
			z-index: 1050 !important;
			box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
			padding: 0.25rem 0;
		}

		/* Öğe stili */
		.ui-menu-item-wrapper {
			padding: 0.5rem 1rem;
			color: #3f4254;
			font-weight: 500;
			transition: background-color 0.2s;
		}

		/* Hover efekti */
		.ui-menu-item-wrapper.ui-state-active {
			background-color: #009ef7;
			color: #fff;
			border-radius: 0.325rem;
		}
	</style>

	<script>
		$(function () {
			// FirstName autocomplete
			$("#firstNameInput").autocomplete({
				source: function (request, response) {
					$.ajax({
						url: '@Url.Action("SearchApiUserFirstNameAutocomplete", "ApiUser")',
						data: { term: request.term },
						success: function (data) {
							response(data);
						}
					});
				},
				minLength: 1
			});

			// LastName autocomplete
			$("#lastNameInput").autocomplete({
				source: function (request, response) {
					$.ajax({
						url: '@Url.Action("SearchApiUserLastNameAutocomplete", "ApiUser")',
						data: { term: request.term },
						success: function (data) {
							response(data);
						}
					});
				},
				minLength: 1
			});

			// Email autocomplete
			$("#emailInput").autocomplete({
				source: function (request, response) {
					$.ajax({
						url: '@Url.Action("SearchApiUserEmailAutocomplete", "ApiUser")',
						data: { term: request.term },
						success: function (data) {
							response(data);
						}
					});
				},
				minLength: 1
			});
		});
	</script>
	
	<script>
		var localizedTexts = {
			unsavedChangesTitle: '@SharedLocalizer["Unsaved_Changes_Title"]',
			unsavedChangesText: '@SharedLocalizer["Unsaved_Changes_Text"]',
			confirmButtonText: '@SharedLocalizer["Yes_Leave"]',
			cancelButtonText: '@SharedLocalizer["No_Stay"]',
			formSubmittedText: '@SharedLocalizer["Form_Submitted_Text"]',
			okButtonText: '@SharedLocalizer["Ok_Button_Text"]'
		};
		var localizer = {
			emptyTable: '@SharedLocalizer["Empty_Data"]',
			info: '@SharedLocalizer["Info"]',
			infoEmpty: '@SharedLocalizer["Info_Empty"]',
			infoFiltered: '@SharedLocalizer["Info_Filtered"]',
			zeroRecords: '@SharedLocalizer["Zero_Records"]'
		};

		// Scroll hareket ettirildiğinde option menüsünü kapatır.
		$(document).ready(function () {
			$(window).on('scroll', function () {
				$('.dropdown-menu.show').removeClass('show');
				$('.dropdown-toggle[aria-expanded="true"]').attr('aria-expanded', 'false');
				console.log("Scroll hareketi çalıştı.")
			});

		});

		document.addEventListener('DOMContentLoaded', function () {
			var currentPageSize = @currentPageSize;
			document.getElementById('pageSize').value = currentPageSize;
		});


		function changePageSize() {
			var pageSize = document.getElementById('pageSize').value;
			var url = new URL(window.location.href);

			var typeOfApiUser = url.searchParams.get('typeOfApiUser') || '';

			url.searchParams.set('pageSize', pageSize);
			url.searchParams.set('page', 1);

			if (typeOfApiUser) {
				url.searchParams.set('typeOfApiUser', typeOfApiUser);
			}

			window.location.href = url.toString();
		}

		$(document).ready(function () {
			$('#pageSizeDropdown').change(function () {
				var selectedPageSize = $(this).val();
				var url = new URL(window.location.href);


				var typeOfApiUser = url.searchParams.get('typeOfApiUser') || '';


				url.searchParams.set('pageSize', selectedPageSize);
				url.searchParams.set('page', 1);

				if (typeOfApiUser) {
					url.searchParams.set('typeOfApiUser', typeOfApiUser);
				}
				window.location.href = url.toString();
			});
		});


		$(document).ready(function () {

			var currentPageSize = '@ViewBag.PageSize' || '10';

			$('#pageSizeDropdown').val(currentPageSize);

			$('#pageSizeDropdown').change(function () {

				var selectedPageSize = $(this).val();

				var currentPage = '@ViewBag.CurrentPage';


			});

		});

	</script>

}







